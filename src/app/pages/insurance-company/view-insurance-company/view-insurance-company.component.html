<div class="breadcrumbs mb-3">
    <strong>Insurnace Companies (Brokers) </strong>
</div>
<div class="row">
    <div class="col-xl-3">
        <div class="card">
            <div class="card-body d-flex flex-wrap justify-content-between align-items-start bg-alice-blue">
                <div class="">
                    <div class="text-dark f-13 font-weight-bold"> Total Open Balance</div>
                    <div class="text-dark font-weight-bold font-size-24">{{totalPayable  }} AED</div>
                    <div class="font-size-12 text-default">Analytics for this month</div>
                </div>
                <div class="">
                    <img src="assets/images/home/cash-icon.svg" width="50px" alt="Icon" />
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    <div class="row mb-4">
        <div class="col-xl-10">
            <div class="w-25 searchBarWidth">
                <nz-input-group nzSize="large" [nzPrefix]="suffixIconSearch">
                    <input type="text" nz-input [(ngModel)]="search" (ngModelChange)="filter()"
                        placeholder="Search for Company" />
                </nz-input-group>
                <ng-template #suffixIconSearch>
                    <i nz-icon nzType="search"></i>
                </ng-template>
            </div>
        </div>
        <div class="col-xl-2">
            <a nz-button class="float-right" nzType="primary" 
                (click)="showModal()">Add Company</a>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="insurance-box">
                <h5 class="p-4" style="border-bottom: 1px solid #000;">Search Filters</h5>
                <mat-form-field class="col-xl-12">
                    <mat-label>Search Query</mat-label>
                    <input type="text" placeholder="Branch Name" matInput  formControlName="branchName"/>
                </mat-form-field>
                <mat-form-field class="col-xl-12">
                    <mat-label>Search Query</mat-label>
                    <input type="text" placeholder="Branch Name" matInput  formControlName="branchName"/>
                </mat-form-field>
                <mat-form-field class="col-xl-12">
                    <mat-label>Search Query</mat-label>
                    <input type="text" placeholder="Branch Name" matInput  formControlName="branchName"/>
                </mat-form-field>
                <mat-form-field class="col-xl-12">
                    <mat-label>Search Query</mat-label>
                    <input type="text" placeholder="Branch Name" matInput  formControlName="branchName"/>
                </mat-form-field>
                <div class="text-center py-4">
                    <a nz-button nzType="primary">Search</a>
                </div>
            </div>
        </div>
        <div class="col-xl-9">
            <nz-table class="card" #rowSelectionTable [nzData]="listData" [nzNoResult]="noData" nzShowSizeChanger
            [nzPageSize]="pageSize" [nzTableLayout]="'fixed'" [nzBordered]="true" [nzSize]="'small'">
            <thead>
                <tr>
                    <th [nzLeft]="true" [nzWidth]="'100px'" class="ant-table-selection-column" [nzSortFn]="sortNumbersFn" (click)="sortOn('index')">#</th>
                    <th  [nzLeft]="true" [nzWidth]="'164px'" > Logo</th>
                    <th [nzLeft]="true"  [nzAlign]="'center'"  [nzSortFn]="sortNamesFn" (click)="sortOn('number')">Company Person / Company</th>
                    <th [nzLeft]="true"  [nzAlign]="'center'" [nzSortFn]="sortNumbersFn" (click)="sortOn('type')">Email </th>
                    <th [nzRight]="true" [nzAlign]="'center'"  [nzSortFn]="sortNamesFn" (click)="sortOn('name')">Phone</th>
                    <th [nzRight]="true" [nzAlign]="'center'"  [nzSortFn]="sortNumbersFn" (click)="sortOn('openBalance')">Open Balance </th>         
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of rowSelectionTable.data; let i = index;" (click)="showSingleSalesAgent(data)" style="cursor: pointer;">
                    <td [nzLeft]="true" [nzAlign]="'center'">{{i+1}}</td>
                    <td *ngIf="data.imageUrl==null">
                        <nz-avatar crossorigin="anonymous"  [nzShape]="'square'" [nzSize]="164" [nzIcon]="'user'"></nz-avatar>
                    </td>
                    <td *ngIf="data.imageUrl">
                        <nz-avatar crossorigin="anonymous"  [nzShape]="'square'" [nzSize]="164" [nzSrc]="data.imageUrl"></nz-avatar>
                    </td>
                    <td>
                            <div class="font-size-16">
                            {{   ((data.title=="" || data.title==null) && data.firstName=="" && data.middleName=="" &&  data.lastName=="")? "Parent Account" :data?.company}}
                            </div>
                    </td>
                    <td >{{ data.email }}</td>
                    <td >{{ data.phone }}</td>
                    <td >{{data.openBalance }} AED</td>             
                    <td>
                        <i nz-icon nzType="fund-view" style="font-size:32px;" nzTheme="outline" nz-tooltip nzTooltipTitle="View Account History"
                            class="text-success" (click)="$event.stopPropagation(editAccount(data))"></i>
                    </td> 
                </tr>
            </tbody>
            </nz-table>
        </div>
    </div>
</div>
<div class="add-account-modal-div">
    <nz-modal nzFooter="null" nzWidth="1000" [(nzVisible)]="isVisible" nzMaskClosable="false"
        [nzTitle]="isEditMode ? 'Update Insurance Company':'Create New Insurance Company'" (nzOnCancel)="handleCancel()">
        <app-add-insurance-company></app-add-insurance-company>
        </nz-modal>
</div>

<ng-template #noData>
    <nz-empty class="m-5" [nzNotFoundImage]="'assets/images/no-data/no-account.svg'" [nzNotFoundContent]="noDataDescrp">
    </nz-empty>
</ng-template>